<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Prepare/learn">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Learn | IBM Client Engineering</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/img/logo.svg"><meta data-rh="true" property="og:url" content="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/Prepare/learn"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="ibm client engineering, open solutions library,  filenet, eks, aws, cp4ba, filenet on aws eks"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Learn | IBM Client Engineering"><meta data-rh="true" name="description" content="Installing and Configuring IBM MQ and RDQM"><meta data-rh="true" property="og:description" content="Installing and Configuring IBM MQ and RDQM"><link data-rh="true" rel="icon" href="/solution-mq-rdqm-hadr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/Prepare/learn"><link data-rh="true" rel="alternate" href="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/Prepare/learn" hreflang="en"><link data-rh="true" rel="alternate" href="https://ibm-client-engineering.github.io/solution-mq-rdqm-hadr/Prepare/learn" hreflang="x-default"><link rel="stylesheet" href="/solution-mq-rdqm-hadr/assets/css/styles.1116ef7f.css">
<link rel="preload" href="/solution-mq-rdqm-hadr/assets/js/runtime~main.ae90d6c1.js" as="script">
<link rel="preload" href="/solution-mq-rdqm-hadr/assets/js/main.2f67b9e3.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/solution-mq-rdqm-hadr/"><div class="navbar__logo"><img src="/solution-mq-rdqm-hadr/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA" height="200" width="200"><img src="/solution-mq-rdqm-hadr/img/logo-dark.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="200" width="200"></div><b class="navbar__title text--truncate">| Middleware Automation</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/${vars.org}/${vars.project}" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/solution-mq-rdqm-hadr/">Flight Path</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/solution-mq-rdqm-hadr/category/innovate">Innovate</a><button aria-label="Toggle the collapsible sidebar category &#x27;Innovate&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/solution-mq-rdqm-hadr/category/prepare">Prepare</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prepare&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/solution-mq-rdqm-hadr/Prepare/learn">Learn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-mq-rdqm-hadr/Prepare/organize">Organize</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-mq-rdqm-hadr/Prepare/stage">Stage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/solution-mq-rdqm-hadr/category/co-create">Co-Create</a><button aria-label="Toggle the collapsible sidebar category &#x27;Co-Create&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/solution-mq-rdqm-hadr/category/transition">Transition</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transition&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/solution-mq-rdqm-hadr/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/solution-mq-rdqm-hadr/category/prepare"><span itemprop="name">Prepare</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Learn</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Learn</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-and-configuring-ibm-mq-and-rdqm">Installing and Configuring IBM MQ and RDQM<a href="#installing-and-configuring-ibm-mq-and-rdqm" class="hash-link" aria-label="Direct link to Installing and Configuring IBM MQ and RDQM" title="Direct link to Installing and Configuring IBM MQ and RDQM">​</a></h3><p>This document serves as a documented process for installing IBM MQ and RDMQ bound to the # Solution Strategy. It assumes some basic familiarlity with Linux command line.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-of-mq">Installation of MQ<a href="#installation-of-mq" class="hash-link" aria-label="Direct link to Installation of MQ" title="Direct link to Installation of MQ">​</a></h3><p>In order to build out our setup, we are assuming three hosts that live in three different zones in a Dallas region and three hosts in three zones living in the Washington DC region . Our bastion host will also live in WDC and that&#x27;s where we&#x27;ll base our primary HA stack. We also assume root access via ssh to all hosts here. The OS on the mq hosts for our purposes will be <strong>Red Hat 8.4</strong>. We will also assume they are properly subscribed.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">10.241.1.4      wdc-bastion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WDC mq hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.241.0.4          wdc1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.241.64.4         wdc2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.241.128.4        wdc3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DAL mq hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.240.0.4          dal1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.240.64.4         dal2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.240.128.4        dal3-mq1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Above is what the hosts file on our bastion host should look like. We would connect to the bastion host via a public ip. We won&#x27;t go into configuring ssh <code>proxyjump</code> in this section.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="host-layout">Host layout<a href="#host-layout" class="hash-link" aria-label="Direct link to Host layout" title="Direct link to Host layout">​</a></h4><p>Each of the above hosts barring the bastion have two extra disks attached:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Disk /dev/vda: 100 GiB, 107374182400 bytes, 209715200 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk /dev/vdb: 100 GiB, 107374182400 bytes, 209715200 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk /dev/vde: 25 GiB, 26843545600 bytes, 52428800 sectors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>/dev/vda</code> is our boot volume</li><li><code>/dev/vdb</code> will become our logical volume for <code>/var/mqm</code></li><li><code>/dev/vde</code> will be our RDQM managed volume</li></ul><p>IBM MQ installation recommends multiple separate disks for various aspects of MQ to increase performance and minimize overall I/O during heavy operations. For our purposes, we will only be going with one volume for MQ.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="system-preparation">System preparation<a href="#system-preparation" class="hash-link" aria-label="Direct link to System preparation" title="Direct link to System preparation">​</a></h4><ol><li>Create the mqm userid and group. This step occurs on all host minus the bastion host.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">groupadd -g 1001 mqm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useradd -g mqm -u 1001 -m -c &quot;MQM User&quot; mqm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Update mqm user&#x27;s bashrc and bash profile. These paths don&#x27;t exist as of yet until the actual installation of MQ. This needs to be done on all nodes.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;export MQ_INSTALLATION_PATH=/opt/mqm&quot; &gt;&gt; ~mqm/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;. $MQ_INSTALLATION_PATH/bin/setmqenv -s&#x27; &gt;&gt; ~mqm/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;export PATH=$PATH:/opt/mqm/bin:/opt/mqm/samp/bin:&#x27; &gt;&gt; ~mqm/.bash_profile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Update <code>/etc/sudoers</code> with the correct permissions for mqm user on all nodes.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;%mqm ALL=(ALL) NOPASSWD: /opt/mqm/bin/crtmqm,/opt/mqm/bin/dltmqm,/opt/mqm/bin/rdqmadm,/opt/mqm/bin/rdqmstatus&quot; &gt;&gt; /etc/sudoers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><p><strong>OPTIONAL</strong> - for ease of use and communication, you can create an ssh key for the <code>mqm</code> user and propagate it across the nodes in each stack. This isn&#x27;t required, but it can mean you might only need to run some commands on the primary node in each stack and it will run the appropriate commands on each node behind the scenes.</p><p>On Node 1:</p></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">as mqm user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ ssh-keygen -t rsa -f /home/mqm/.ssh/id_rsa -N &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal1-mq1 ~]$ ssh-keygen -t rsa -f /home/mqm/.ssh/id_rsa -N &#x27;&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Manually copy the public key to the <code>authorized_keys</code> file in <code>~/.ssh</code> for <code>mqm</code> user on each node in each stack.</p><ol start="5"><li>Install lvm2 if it&#x27;s not already there on all nodes</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install lvm2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Setup the volume group and logical volume for <code>/var/mqm</code> on all nodes. Device names may be different depending on your environment.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pvcreate /dev/vdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vgcreate MQStorageVG /dev/vdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvcreate -n MQStorageLV -l100%VG MQStorageVG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>Create the <code>/var/mqm</code> directory and format the storage volume</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /var/mqm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkfs.xfs /dev/MQStorageVG/MQStorageLV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mount /dev/MQStorageVG/MQStorageLV /var/mqm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8"><li>Make sure <code>/var/mqm</code> is fully owned by the mqm user and that everything is setup in <code>/etc/fstab</code></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chown -R mqm:mqm /var/mqm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod 755 /var/mqm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;/dev/MQStorageVG/MQStorageLV      /var/mqm        xfs     defaults        1 2&quot; &gt;&gt; /etc/fstab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li>Configure the storage volume for RDQM. <strong>It&#x27;s critical that the volume group is named <code>drbdpool</code>.</strong></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">parted -s -a optimal /dev/vde mklabel gpt &#x27;mkpart primary ext4 1 -1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvcreate /dev/vde1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vgcreate drbdpool /dev/vde1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="10"><li>For SELinux: If keeping selinux set to targeted, run the following:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">semanage permissive -a drbd_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="11"><li>Add the following settings to <code>/etc/sysctl.conf</code></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kernel.shmmni = 4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kernel.shmall = 2097152</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kernel.shmmax = 268435456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kernel.sem = 32 4096 32 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fs.file-max = 524288</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Execute sysctl</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sysctl -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="12"><li>Set the ulimit for the mqm user by adding the following to <code>/etc/security/limits.conf</code></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># For MQM User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqm       hard  nofile     10240</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqm       soft  nofile     10240</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="installing-mq">Installing MQ<a href="#installing-mq" class="hash-link" aria-label="Direct link to Installing MQ" title="Direct link to Installing MQ">​</a></h4><p>This requires you to go to the following link and retrieving IBM MQ Advanced developer version 9.2.5:</p><p><a href="https://www14.software.ibm.com/cgi-bin/weblap/lap.pl?popup=Y&amp;li_formnum=L-APIG-BYHCL7&amp;accepted_url=https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/messaging/mqadv/mqadv_dev925_linux_x86-64.tar.gz" target="_blank" rel="noopener noreferrer"><strong>mqadv_dev925_linux_x86-64.tar.gz</strong></a></p><p>Once you have the package,  you will need to upload it to all six hosts. This document will assume you have done this. The following steps need to be taken on each host.</p><ol><li>Extract the package on each host</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tar zxvf mqadv_dev931_linux_x86-64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd MQServer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Run the mqlicense script to accept the IBM license</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./mqlicense.sh -accept</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Install the packages for MQ on each host</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install MQSeries*.rpm --nogpgcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Run the following command <strong>ONLY</strong> on the primary node in each stack. For example, for our WDC stack we would run this on <code>wdc1-mq1</code> and for our Dallas stack we would run this only on <code>dal1-mq1</code></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@dal1-mq1 ~]# /opt/mqm/bin/setmqinst -i -p /opt/mqm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@wdc1-mq1 ~]# /opt/mqm/bin/setmqinst -i -p /opt/mqm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-rdqm">Installing RDQM<a href="#installing-rdqm" class="hash-link" aria-label="Direct link to Installing RDQM" title="Direct link to Installing RDQM">​</a></h3><p>One of the primary components for RDQM is DRBD. IBM packages its own kmod-drbd packages with the MQ tar file. This is why knowing what kernel version you are running is critical. For this, IBM included a script called <code>modver</code>. The following commands need to be performed on every host in each region.</p><ol><li>On each host, run the <code>modver</code> script to determine which kmod to install</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/MQServer/Advanced/RDQM/PreReqs/el8/kmod-drbd-9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./modver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kmod-drbd-9.1.5_4.18.0_305-1.x86_64.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This should show you which of the kernel packages in that directory that you need to install. If it returns any sort of error, you need to follow the link it provides and download the appropriate kmod-drbd version.</p><ol start="2"><li>Install the kmod-drbd version</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/MQServer/Advanced/RDQM/PreReqs/el8/kmod-drbd-9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install $(./modver) --nogpgcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Install pacemaker and drbd-utils</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd MQServer/Advanced/RDQM/PreReqs/el8/pacemaker-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install *.rpm --nogpgcheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd MQServer/Advanced/RDQM/PreReqs/el8/drbd-utils-9/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install *.rpm --nogpgcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Install policycoretutils-python-utils to set the correct security context for DRBD</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install policycoreutils-python-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">semanage permissive -a drbd_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Configure <code>firewalld</code> on each host. We&#x27;re going to add a range of ports for async communication between stacks as well as between nodes. We&#x27;ll also add our listener ports for the queue listener services.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port=6996-7800/tcp --permanent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port=1414-1514/tcp --permanent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Finally, install the RDQM package itself</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf -y install ~/MQServer/Advanced/RDQM/MQSeriesRDQM-9.2.5-0.x86_64.rpm --nogpgcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>Edit <code>/var/mqm/rdqm.ini</code> and add in the hosts for that stack. This will be different per region but the <code>Name</code> field needs to be added to the default file and it <strong>must</strong> match the hostname of each node:</li></ol><p><code>/var/mqm/rdqm.ini</code> in WDC</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=wdc1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=wdc2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.241.64.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=wdc3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.241.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#DRGroup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  Name=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>/var/mqm/rdqm.ini</code> in DAL</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=dal1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=dal2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.240.64.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name=dal3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HA_Replication=10.240.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Primary=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  HA_Alternate=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#DRGroup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  Name=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  DR_Replication=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8"><li>Run the following on the primary node in each region:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/opt/mqm/bin/rdqmadm -c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the ssh key was configured as mentioned above, the mqm user should be able to run this command on each node in the background. Otherwise the STDOUT returned will tell you wnat nodes still need to have it run.</p><ol start="9"><li>Verify we&#x27;re all online with:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rdqmstatus -n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="10"><li>Update the groups for <code>mqm</code> user. The <code>mqm</code> user must be a member of the <code>haclient</code> group in order to perform some tasks on replicated queumanagers like <code>endmqm</code> or <code>strmqm</code>. This must be run on all nodes.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">usermod -a -G haclient mqm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-disaster-recovery-queue">Creating A Disaster Recovery Queue<a href="#creating-a-disaster-recovery-queue" class="hash-link" aria-label="Direct link to Creating A Disaster Recovery Queue" title="Direct link to Creating A Disaster Recovery Queue">​</a></h3><p>Now we are at the meat and potatoes. We&#x27;re going to cover the steps to create a DR queue that is async replicated between regions. Let&#x27;s get started.</p><p>Order is everything when it comes to creating a DR queue. The creation command is always run on the last node first and first node last.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-drhaqm1-with-primary-in-dc">Creating DRHAQM1 With Primary in DC<a href="#creating-drhaqm1-with-primary-in-dc" class="hash-link" aria-label="Direct link to Creating DRHAQM1 With Primary in DC" title="Direct link to Creating DRHAQM1 With Primary in DC">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WDC region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc3-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr p -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc2-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr p -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sx -rr p -p 1501 -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1 # Primary node in the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DAL region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal3-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal2-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal1-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sx -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7001 -fs 3072M DRHAQM1 # Primary node in the stack</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s break down these commands:</p><p><strong><code>crtmqm</code></strong> - command to actually create the queues</p><ul><li><strong><code>-sxs</code></strong> - Replicated data HA secondary queue manager. This is run only on secondary or standby nodes when creating the queue.</li><li><strong><code>-sx</code></strong> - Replicated data HA Primary queue manager. This is run only on a primary node where you want the queue to live.</li><li><strong><code>-rr [p,s]</code></strong> - This is region specific. When you create your DR Queue, you would use &quot;p&quot; for the region you want to be DR Primary and &quot;s&quot; for the region you want to be standby. If you accidentally use &quot;p&quot; for both regions, your clusters will not talk to each other.</li><li><strong><code>-rl</code></strong>  <code>10.241.0.4,10.241.64.4,10.241.128.4</code> - Specifies the local ip address(es) to be used for DR replication of this queue manager. Basically your local region nodes go here.</li><li><strong><code>-ri</code></strong>  <code>10.240.0.4,10.240.64.4,10.240.128.4</code> - Specifies the IP address of the interface used for replication on the server hosting the secondary instance of the queue manager. Basically your remote region&#x27;s nodes.</li><li><strong><code>-rp 7001</code></strong> - Specifies the port to use for DR replication. We&#x27;re using port 7001 in this example.</li><li><strong><code>-fs 3072M</code></strong> - Specifies the size of the filesystem to create for the queue manager - that is, the size of the logical volume which is created in the drbdpool volume group. Another logical volume of that size is also created, to support the reverting to snapshot operation, so the total storage for the DR RDQM is just over twice that specified here.</li></ul><p>If everything was done correctly, you should be able to log into your primary node in your primary region and run the following commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ sudo rdqmstatus -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager status:                   Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CPU:                                    0.00%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Memory:                                 182MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager file system:              58MB used, 2.9GB allocated [2%]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA control:                             Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA current location:                    This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA preferred location:                  This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA blocked location:                    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP interface:               None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP address:                 None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR port:                                7001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR local IP address:                    10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR remote IP address list:              10.240.0.4,10.240.64.4,10.240.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR current remote IP address:           10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal1-mq1 ~]$ sudo rdqmstatus -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager status:                   Ended immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA control:                             Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA current location:                    This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA preferred location:                  This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA blocked location:                    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP interface:               None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP address:                 None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR role:                                Secondary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR port:                                7001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR local IP address:                    10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR remote IP address list:              10.241.0.4,10.241.64.4,10.241.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR current remote IP address:           10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This queue service listener should be active on port 1501 on the primary node in the primary region only.</p><p>You can test failover with the following commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This tells the first node in the WDC region to become DR standby for the DRHAQM1 queue service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@wdc1-mq1 ~]# rdqmdr -s -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This tells the first node in the DAL region to become DR primary for the DRHAQM1 queue service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@dal1-mq1 ~]# rdqmdr -p -m DRHAQM1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So now the output of <code>rdqmstatus</code> will be:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@dal1-mq1 ~]# sudo rdqmstatus -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager status:                   Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CPU:                                    1.09%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Memory:                                 182MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager file system:              58MB used, 2.9GB allocated [2%]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA control:                             Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA current location:                    This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA preferred location:                  This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA blocked location:                    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP interface:               None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP address:                 None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR port:                                7001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR local IP address:                    10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR remote IP address list:              10.241.0.4,10.241.64.4,10.241.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR current remote IP address:           10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   dal3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@wdc1-mq1 ~]# sudo rdqmstatus -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager status:                   Ended immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA control:                             Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA current location:                    This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA preferred location:                  This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA blocked location:                    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP interface:               None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP address:                 None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR role:                                Secondary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR port:                                7001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR local IP address:                    10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR remote IP address list:              10.240.0.4,10.240.64.4,10.240.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR current remote IP address:           10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can fail everything back with the following commands</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@dal1-mq1 ~]# rdqmdr -s -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@wdc1-mq1 ~]# rdqmdr -p -m DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The queue service should be accessible via port <code>1501</code> on the primary node in the primary region.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-mqipt">Installing MQIPT<a href="#installing-mqipt" class="hash-link" aria-label="Direct link to Installing MQIPT" title="Direct link to Installing MQIPT">​</a></h3><ul><li>SSH into your MQIPT server(s).</li><li>Download and stage the MQIPT Software from <a href="https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&amp;product=ibm/WebSphere/WebSphere+MQ&amp;release=9.2.0.0&amp;platform=All&amp;function=all" target="_blank" rel="noopener noreferrer">IBM Fix Central</a></li></ul><p>In our instance we are downloading version <code>9.2.5.0-IBM-MQIPT-LinuxX64</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://ak-delivery04-mul.dhe.ibm.com/sdfdl/v2/sar/CM/WS/0abcp/0/Xa.2/Xb.jusyLTSp44S0Bn8mossn7uopQHHST9iA1hmsJz52XllxgZWtruzIzbUG_ZE/Xc.CM/WS/0abcp/0/9.2.5.0-IBM-MQIPT-LinuxX64.tar.gz/Xd./Xf.LPR.D1VK/Xg.11755825/Xi.habanero/XY.habanero/XZ.1osh26bJ4dLZBVRjImrn31hkVvRbtvt0/9.2.5.0-IBM-MQIPT-LinuxX64.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Please note that the <code>wget</code> command will not work - we are simply copying the direct link to the download from Fix Central and using <code>wget</code> to stage the software directly on the MQIPT servers.</p><ul><li>Create a directory to unpack the MQ IPT Software</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /opt/mqipt/installation1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Unpack the MQIPT software and modify permissions</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /opt/mqipt/installation1/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar zxvf ~/9.2.5.0-IBM-MQIPT-LinuxX64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod -R a-w /opt/mqipt/installation1/mqipt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Append the following to your <code>~/.bashrc</code> file for your MQIPT user</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MQIPT_PATH=/opt/mqipt/installation1/mqipt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MQIPT_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:$MQIPT_PATH/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>You can now <code>source</code> your .bashrc by issuing the following command</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">. ~/.bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create MQIPT configuration file</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /opt/mqipt/installation1/mqipt/configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /opt/mqipt/installation1/mqipt/samples/mqiptSample.conf /opt/mqipt/installation1/mqipt/configs/mqipt.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this instance we are copying the sample configuration file to our MQIPT installation destination.</p><ul><li>Modify the <code>mqipt.conf</code> file</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[route]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name=DRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ListenerPort=1501</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Destination=&lt;hostname of your load balancer&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DestinationPort=1501</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[route]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name=DRHAQM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ListenerPort=1502</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Destination=&lt;hostname of your load balancer&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DestinationPort=1502</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this implementation we are creating two <code>[route]</code> entries for the two different regions that correspond to our 2 queues. Recall that we had previously created <code>DRHAQM1</code> and <code>DRHAQM2</code> to be listening on ports <code>1501</code> and <code>1502</code> respectively. Our loadbalanacer was also configured to forward traffic to these ports.</p><ul><li>Start MQIPT</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqipt /opt/mqipt/installation1/mqipt -n HAMQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see the following output</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 2000, 2022 All Rights Reserved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI001 IBM MQ Internet Pass-Thru 9.2.5.0 starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI004 Reading configuration information from mqipt.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI152 MQIPT name is DRHAMQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI022 Password checking has been disabled on the command port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI144 MQ Advanced capabilities not enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI011 The path /opt/mqipt/installation1/mqipt/configs/logs will be used to store the log files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI006 Route 1502 is starting and will forward messages to :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI034 .... ourlb.appdomain.cloud(1502)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI035 ....using MQ protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI078 Route 1502 ready for connection requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI006 Route 1501 is starting and will forward messages to :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI034 ....ourlb.appdomain.cloud(1501)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI035 ....using MQ protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQCPI078 Route 1501 ready for connection requests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this initial implementation of MQIPT does not account for any mTLS or handshaking. In this mode, it is simply proxying traffic to the MQ servers (through our loadbalancers).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable-mqipt-as-a-system-service">Enable MQIPT as a system service<a href="#enable-mqipt-as-a-system-service" class="hash-link" aria-label="Direct link to Enable MQIPT as a system service" title="Direct link to Enable MQIPT as a system service">​</a></h4><p><em>This assumes you are running on Red Hat &gt;= 7.x, CentOS &gt;= 7.x, or Ubuntu &gt;= 16.x</em></p><p>Create a new systemd service file called <code>/etc/systemd/system/mqipt.service</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=MQIPT Service for IBM MQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/bin/bash -c &quot;/opt/mqipt/installation1/mqipt/bin/mqipt /opt/mqipt/installation1/mqipt/configs -n HAMQ&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStop=/bin/bash -c &quot;/opt/mqipt/installation1/mqipt/bin/mqiptAdmin -stop -n HAMQ&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the file we created above, we&#x27;ve named our MQIPT instance as <strong>HAMQ</strong>. Logs can be viewed using the <code>systemctl</code> command or the <code>journalctl</code> command.</p><p>Refresh systemd with <code>systemctl daemon-reload</code></p><p>Now MQIPT can be enabled to start on boot</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable mqipt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will install the service file for mqipt to <code>/etc/init.d</code> which can be controlled using the <code>systemctl</code> command.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start mqipt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make sure to enable this at boot time</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable mqipt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="templating-the-service-file-for-multiple-mqipt-instances">Templating the service file for multiple MQIPT instances<a href="#templating-the-service-file-for-multiple-mqipt-instances" class="hash-link" aria-label="Direct link to Templating the service file for multiple MQIPT instances" title="Direct link to Templating the service file for multiple MQIPT instances">​</a></h4><p>MQIPT has the ability to run with multiple instances and to control that with systemd we can simply create a config directory for each instance we want to control and run each with separate systemd templates. For example, we want to create an instance of MQIPT and name it <code>HAMQ</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /opt/mqipt/installation1/mqipt/HAMQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Move our existing <code>mqipt.conf</code> to that directory</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mv /opt/mqipt/installation1/mqipt/configs/mqipt.conf /opt/mqipt/installation1/mqipt/HAMQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a systemd service template as <code>/etc/systemd/system/mqipt-@.service</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">touch /etc/systemd/system/mqipt-\@.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi /etc/systemd/system/mqipt-\@.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Insert the following into the new service file</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=MQIPT Service for IBM MQ %i Instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/bin/bash -c &quot;/opt/mqipt/installation1/mqipt/bin/mqipt /opt/mqipt/installation1/mqipt/%i -n %i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStop=/bin/bash -c &quot;/opt/mqipt/installation1/mqipt/bin/mqiptAdmin -stop -n %i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecReload=/bin/bash -c &quot;/opt/mqipt/installation1/mqipt/bin/mqiptAdmin -refresh -n %i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now this service template can be enabled for our <code>HAMQ</code> instance with the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable mqipt-@HAMQ.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start mqipt-@HAMQ.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now if we want to run multiple instances of MQIPT that bind to different ports, we can do so with separate instance names that are controllable via systemd by simply creating the instance directory in <code>/opt/mqipt/installation1/mqipt</code>, putting a unique <code>mqipt.conf</code> in that directory, and then enabling it as a service with systemctl.</p><p>We can also update our configs and refresh the instance without restarting mqipt with</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl reload mqipt-@HAMQ.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>It&#x27;s important to note that your instances can&#x27;t be on the same ports.</strong></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-new-queue-manager">Creating the new queue manager<a href="#creating-the-new-queue-manager" class="hash-link" aria-label="Direct link to Creating the new queue manager" title="Direct link to Creating the new queue manager">​</a></h4><p>Starting with <code>wdc3-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc3-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr p -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ secondary queue manager created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>wdc2-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dwdc2-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr p -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ secondary queue manager created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>wdc1-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sx -rr p -rl 10.241.0.4,10.241.64.4,10.241.128.4 -ri 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;SSLDRHAQM1&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directory &#x27;/var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The queue manager is associated with installation &#x27;Installation1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating or replacing default objects for queue manager &#x27;SSLDRHAQM1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default objects statistics : 83 created. 0 replaced. 0 failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Completing setup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setup completed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabling replicated data queue manager.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Replicated data queue manager enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Issue the following command on the remote HA group to create the DR/HA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary queue manager:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crtmqm -sx -rr s -rl 10.240.0.4,10.240.64.4,10.240.128.4 -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now wash, rinse, repeat and create the queue with the <code>-rr</code> option set as <code>s</code> on the DR queue in Dallas:</p><p><code>dal3-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal3-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ secondary queue manager created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>dal2-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@dal2-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sxs -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ secondary queue manager created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>dal1-mq1</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@ceng-dal1-mq1 ~]$ sudo /opt/mqm/bin/crtmqm -sx -rr s -ri 10.241.0.4,10.241.64.4,10.241.128.4 -rl 10.240.0.4,10.240.64.4,10.240.128.4 -rp 7005 -fs 3072M SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating replicated data queue manager configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ secondary queue manager created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabling replicated data queue manager.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Replicated data queue manager enabled.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we should see a happy replicated queue</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@wdc1-mq1 ~]# rdqmstatus -m SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc1-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager status:                   Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CPU:                                    0.00%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Memory:                                 182MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Queue manager file system:              58MB used, 2.9GB allocated [2%]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA control:                             Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA current location:                    This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA preferred location:                  This node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA blocked location:                    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP interface:               None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA floating IP address:                 None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR role:                                Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR port:                                7005</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR local IP address:                    10.241.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR remote IP address list:              10.240.0.4,10.240.64.4,10.240.128.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DR current remote IP address:           10.240.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc2-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:                                   wdc3-mq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HA status:                              Normal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s create the queue. From the primary node, log into the queue manager and create the channel and the queue and the listener at port 1503:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ runmqsc SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE CHANNEL(SSLDRHAQM1.MQIPT) CHLTYPE(SVRCONN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE QLOCAL(MQIPT.LOCAL.QUEUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE listener(LISTENER) trptype(tcp) control(qmgr) port(1503)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start listener(LISTENER)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-ssl-in-queue-manager-and-client">Configuring SSL in Queue Manager and client<a href="#configuring-ssl-in-queue-manager-and-client" class="hash-link" aria-label="Direct link to Configuring SSL in Queue Manager and client" title="Direct link to Configuring SSL in Queue Manager and client">​</a></h4><p>Firstly, let&#x27;s verify where our SSL key directory is in the queue manager</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqsc -u mqadmin SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2021.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager SSLDRHAQM1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISPLAY QMGR SSLKEYR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15 : DISPLAY QMGR SSLKEYR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8408I: Display Queue Manager details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   QMNAME(DRHAQM1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLKEYR(/var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/key)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the default entry for the queue manager. So initially, we want to create a keyfile db. This is going to live at the path we found above. This is important since our example queue manager is replicated via RDMQ so it this keyfile needs to be on the replicated volume.</p><p>So first, let&#x27;s create a key repo on the MQ primary node:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqakm -keydb -create -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile -pw &#x27;p@ssw0rd&#x27; -type cms -stash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This should create the following files:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssldrhaqm1KeyFile.crl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssldrhaqm1KeyFile.kdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssldrhaqm1KeyFile.rdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssldrhaqm1KeyFile.sth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Very important! Make sure the directory and file permissions are correct for the generated key db! The file should be owned by the user running that queue. Ig <code>mqm</code> as an example. Also important to remember, while you&#x27;ll reference the keyfile like <code>/var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile</code> in the queue manager settings, the file itself <strong>must</strong> have the <code>.kdb</code> suffix.</p><p>Now we can populate the keyfile with the default CA signers with the following commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqckm -cert -populate -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb -stashed -label entrust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqckm -cert -populate -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb -stashed -label thawte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqckm -cert -populate -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb -stashed -label verisign</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Should be able to verify that with</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqckm -cert -list -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb -stashed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificates found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* default, - personal, ! trusted, # secret key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Entrust.net Certification Authority (2048) 29&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Entrust Root Certification Authority - EC1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Entrust Root Certification Authority - EV&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Entrust Root Certification Authority - G2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Personal Basic CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Personal Freemail CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Personal Premium CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Premium Server CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Server CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Primary Root CA - G2 ECC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;Thawte Primary Root CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 1 Public Primary Certification Authority&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 1 Public Primary Certification Authority - G2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 1 Public Primary Certification Authority - G3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 2 Public Primary Certification Authority&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 2 Public Primary Certification Authority - G2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 2 Public Primary Certification Authority - G3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 3 Public Primary Certification Authority&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 3 Public Primary Certification Authority - G2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 3 Public Primary Certification Authority - G3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 3 Public Primary Certification Authority - G5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 4 Public Primary Certification Authority - G2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!   &quot;VeriSign Class 4 Public Primary Certification Authority - G3&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So now we&#x27;ve populated the keystore with the default CA signers. Let&#x27;s generate our own self-signed certificate:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqakm -cert -create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-stashed \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-label ssldrhaqm1certlabel \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-dn &quot;cn=SSLDRHAQM1,O=IBM,C=US,OU=SSL For MQ,ST=MA&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-size 2048 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-x509version 3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-expire 7300 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-sig_alg SHA256WithRSA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-type cms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So breaking down the above command:</p><ul><li><code>-db</code> - points to our key database</li><li><code>-pw</code> - is our password for that key database</li><li><code>-stashed</code> - when we created our keystore we created a .sth file that contains the password encrypted. This allows us to pass the <code>-stashed</code> argument.</li><li><code>-label</code> - We&#x27;re gonna label this with our queue manager name</li><li><code>-dn</code> - This is our distinguished name. We&#x27;re leading off with the name of the queue manager.</li><li><code>-size</code> - we&#x27;re setting this to 2048</li><li><code>-x509version</code> - Setting this to 3. This is the default anyway.</li><li><code>-expire</code> - Don&#x27;t want this cert to expire for 7300 days which is the maximum supported by this command.</li><li><code>-sig_alg</code> -  We are going with <code>SHA256WithRSA</code></li><li><code>-type</code> - We&#x27;re going with cms since that&#x27;s the keystore type</li></ul><p>We can verify the certificate creation with</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqm@wdc1-mq1 ~]$ runmqckm -cert -list -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile.kdb -stashed | grep ssldrhaqm1certlabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   ssldrhaqm1certlabel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The dash indicates that this cert label is a personal certificate.</p><p>Now we need to point the queue manager to use our new keystore</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ runmqsc -u mqadmin SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2021.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager SSLDRHAQM1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER QMGR SSLKEYR(&#x27;/var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/ssldrhaqm1KeyFile&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER QMGR CERTLABL(&#x27;ssldrhaqm1certlabel&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH QMGR TYPE(CONFIGEV) OBJECT(AUTHREC)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s important to note that even though the keyfile is <code>ssldrhaqm1KeyFile.kdb</code> it must be referenced in MQ without the <code>.kdb</code> suffix.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-the-channel-auth-for-ssl">Setting the channel auth for SSL<a href="#setting-the-channel-auth-for-ssl" class="hash-link" aria-label="Direct link to Setting the channel auth for SSL" title="Direct link to Setting the channel auth for SSL">​</a></h4><p>Let&#x27;s set our channel authentication</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set CHLAUTH(SSLDRHAQM1.MQIPT) TYPE(USERMAP) CLNTUSER(&#x27;mqadmin&#x27;) USERSRC(MAP) MCAUSER(&#x27;mqadmin&#x27;) ACTION(REPLACE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(SSLDRHAQM1.MQIPT) CHLTYPE(SVRCONN) MCAUSER(&#x27;mqadmin&#x27;) CERTLABL(&#x27;ssldrhaqm1certlabel&#x27;) SSLCAUTH(REQUIRED) SSLCIPH(ANY) TRPTYPE(TCP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH QMGR TYPE(CONFIGEV) OBJECT(AUTHREC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(CONNAUTH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(SSL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(AUTHSERV)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ll set this so the mqadmin user can authenticate in</p><p>Let&#x27;s configure MQIPT for SSLProxy</p><p>On our MQIPT host, edit the <code>/opt/mqipt/installation1/mqipt/HAMQ/mqipt.conf</code> file and add the route entry.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[route]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name=SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ListenerPort=1503</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Destination=3bdf30c3-us-east.lb.appdomain.cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DestinationPort=1503</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLProxyMode=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Reload the mqipt config for this instance</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl reload mqipt-@HAMQ.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s create a client self-signed certificate. Over on our client now:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ mkdir ~/keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ cd ~/keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ /opt/mqm/bin/runmqakm -keydb -create -db mq_cloud_keys -pw &#x27;p@ssw0rd&#x27; -type cms -stash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a personal cert on the client</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ /opt/mqm/bin/runmqakm -cert -create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-db /home/kramerro/keys/mq_cloud_keys \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-pw &#x27;p@ssw0rd&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-label personalcertlabel \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-dn &quot;cn=kramerro,O=IBM,C=US,OU=SSL For MQ,ST=MA&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-size 2048 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-x509version 3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-expire 7300 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-sig_alg SHA256WithRSA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-type kdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This keyfile <strong>MUST also have a <code>.kdb</code> suffix but not referenced with it.</strong></p><p>You can verify the new cert with this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ /opt/mqm/bin/runmqakm -cert -list -db /home/kramerro/keys/mq_cloud_keys.kdb -pw &#x27;p@ssw0rd&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificates found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* default, - personal, ! trusted, # secret key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   personalcertlabel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the MQ Server host, extract the personal certificate from the server key repository and add it to the client repository.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqakm -cert -extract -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/defaultSSLKeyFile.kdb -pw &#x27;p@ssw0rd&#x27; -label ssldrhaqm1certlabel -target ssldrhaqm1certlabel_pubkey.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This should create file called <code>ssldrhaqm1certlabel_pubkey.txt</code> in your current directory. Copy this down to your client.</p><p>Now add the pub cert from the server to your new client key db:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@mq-client keys]$ /opt/mqm/bin/runmqakm -cert -add -db /home/kramerro/keys/mq_cloud_keys -pw &#x27;p@ssw0rd&#x27; -label ssldrhaqm1certlabel -file ssldrhaqm1certlabel_pubkey.txt -format ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we will repeat this but reversed. We are going to extract our client certificate from our client keystore and copy it over to our primary MQ node.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@mq-client keys]$ /opt/mqm/bin/runmqakm -cert -extract -db /Users/kramerro/keys/mq_cloud_keys -pw &#x27;p@ssw0rd&#x27; -label personalcertlabel -target personalcertlabel_pubkey.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Copy that up to the mq host and import it into the server side key store</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ /opt/mqm/bin/runmqakm -cert -add -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/defaultSSLKeyFile.kdb -pw &#x27;p@ssw0rd&#x27; -label personalcertlabel -file personalcertlabel_pubkey.txt -format ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Refresh security on the mq host:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ runmqsc -u mqadmin SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2021.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager SSLDRHAQM1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH QMGR TYPE(CONFIGEV) OBJECT(AUTHREC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(CONNAUTH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(SSL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(AUTHSERV)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now run this command on the client to verify SSL</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@mq-client keys]$ /opt/mqm/samp/bin/amqssslc -m SSLDRHAQM1 -c SSLDRHAQM1.MQIPT -x &quot;52.116.121.144(1501)&quot; -k /home/kramerro/keys/mq_cloud_keys -l personalcertlabel -s TLS_RSA_WITH_AES_256_GCM_SHA384</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If everything was done right, you should see this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSSSLC start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to queue manager SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using the server connection channel SSLDRHAQM1.MQIPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on connection name 52.116.121.144(1501).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using SSL CipherSpec TLS_RSA_WITH_AES_128_CBC_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using SSL key repository stem /home/kramerro/keys/mq_cloud_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Label: personalcertlabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No OCSP configuration specified.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to queue manager SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSSSLC end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-mq-ipt-for-sslserverclient">Configuring MQ-IPT for SSLServer/Client<a href="#configuring-mq-ipt-for-sslserverclient" class="hash-link" aria-label="Direct link to Configuring MQ-IPT for SSLServer/Client" title="Direct link to Configuring MQ-IPT for SSLServer/Client">​</a></h3><p>On the MQ-IPT server, let&#x27;s first create a couple of keystores. These will be labeled for client and server. It&#x27;s important to note that in this context, mqipt is acting as the SSL server for incoming client connections and it is acting as an SSL client for outgoing to the MQ nodes.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqiptKeycmd -keydb -create -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-client.pfx -pw &#x27;p@ssw0rd&#x27; -type pkcs12 -stash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqiptKeycmd -keydb -create -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-server.pfx -pw &#x27;p@ssw0rd&#x27; -type pkcs12 -stash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s create a self-signed cert to install into both keystores</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqiptKeycmd -cert -create -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-server.pfx -stashed -type pkcs12 -label mqiptserver -dn &quot;CN=mqipt-server, OU=IBM, C=US&quot; -sig_alg SHA256WithRSA -size 2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqiptKeycmd -cert -create -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-client.pfx -stashed -type pkcs12 -label mqiptclient -dn &quot;CN=mqipt-client, OU=IBM, C=US&quot; -sig_alg SHA256WithRSA -size 2048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extract the key from the SSL client keystore on mqipt host and copy that up to the mq host and import it into the keystore there:</p><p>MQIPT host</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@wdc-bastion:/opt/mqipt/installation1/mqipt/HAMQ/keys# mqiptKeycmd -cert -extract -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-client.pfx -label mqiptclient -stashed -format ascii -type pkcs12 -target /opt/mqipt/installation1/mqipt/HAMQ/keys/mqiptclient_public.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Primary cluster node</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ /opt/mqm/bin/runmqakm -cert -add -db /var/mqm/vols/ssldrhaqm1/qmgr/ssldrhaqm1/ssl/defaultSSLKeyFile.kdb -pw &#x27;p@ssw0rd&#x27; -label mqiptclient -file mqiptclient_public.pem -format ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Refresh security for that queue manager on the primary cluster node</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ runmqsc SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH QMGR TYPE(CONFIGEV) OBJECT(AUTHREC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(CONNAUTH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(SSL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REFRESH SECURITY TYPE(AUTHSERV)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now extract the public cert for the SSL server from the keystore on mqipt host:</p><p>MQIPT host</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@wdc-bastion:/opt/mqipt/installation1/mqipt/HAMQ/keys# mqiptKeycmd -cert -extract -db /opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-server.pfx -label mqiptserver -stashed -format ascii -type pkcs12 -target /opt/mqipt/installation1/mqipt/HAMQ/keys/mqiptserver_public.pem -format ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Install it in our client so we trust it</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ /opt/mqm/bin/runmqakm -cert -add -db /home/kramerro/keys/mq_cloud_keys -pw &#x27;p@ssw0rd&#x27; -label mqiptserver -file mqiptserver_public.pem -format ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now lets generate a new personal cert on our client machine and import it into mq-ipt&#x27;s keystore</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ runmqakm -cert -create -db mq_cloud_keys -stashed -label wdc-mq-client -dn &quot;CN=wdc-mq-client, OU=IBM, C=US&quot; -sig_alg SHA256WithRSA -size 2048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extract it on the client and import the public cert into mqipt</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ runmqakm -cert -extract -db mq_cloud_keys -pw &#x27;p@ssw0rd&#x27; -label wdc-mq-client -target wdc-mq-client_public.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Import it into MQIPT&#x27;s SSL server keystore</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@wdc-bastion:/opt/mqipt/installation1/mqipt/HAMQ/keys# mqiptKeycmd -cert -add -db mq-ipt-server.pfx -stashed -label wdc-mq-client -file wdc-mq-client_public.txt -format ascii -type pkcs12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Encrypt the keystore password so we can put it into the mqipt.conf file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@wdc-bastion:/opt/mqipt/installation1/mqipt/HAMQ/keys# mqiptPW p@ssw0rd mq-ipt-pw.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a deprecated use for mqiptPW but we&#x27;re gonna roll with it. Make sure the mq-ipt-pw.key file is in the same directory we have our mqipt instance running out of. Probably safer to keep it in the keys directory.</p><p>Modify the mqipt.conf file. Our file is stored in our instance directory <code>/opt/mqipt/installation1/mqipt/HAMQ/mqipt.conf</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[route]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name=SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ListenerPort=1503</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Destination=3bdf30c3-us-east.lb.appdomain.cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DestinationPort=1503</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServer=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServerSiteLabel=mqiptserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServerAskClientAuth=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServerKeyRing=/opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-server.pfx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServerKeyRingPW=/opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-pw.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLServerCipherSuites=SSL_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLClient=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLClientSiteLabel=mqiptclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLClientKeyRing=/opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-client.pfx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLClientKeyRingPW=/opt/mqipt/installation1/mqipt/HAMQ/keys/mq-ipt-pw.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLClientCipherSuites=SSL_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace=0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now reload MQ-IPT</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl reload mqipt-@HAMQ.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify the connection from the client</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kramerro@wdc-mq-client keys]$ /opt/mqm/samp/bin/amqssslc -m SSLDRHAQM1 -c SSLDRHAMQ1.MQIPT -x &quot;52.116.121.144(1503)&quot; -k /home/kramerro/keys/mq_cloud_keys -l wdc-mq-client -s TLS_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSSSLC start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to queue manager SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using the server connection channel SSLDRHAMQ1.MQIPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on connection name 52.116.121.144(1503).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using SSL CipherSpec TLS_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using SSL key repository stem /home/kramerro/keys/mq_cloud_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Label: wdc-mq-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No OCSP configuration specified.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to queue manager SSLDRHAQM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSSSLC end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mq-to-mq-and-ssl-encryption">MQ to MQ and SSL encryption<a href="#mq-to-mq-and-ssl-encryption" class="hash-link" aria-label="Direct link to MQ to MQ and SSL encryption" title="Direct link to MQ to MQ and SSL encryption">​</a></h3><p>For the purposes of testing, we&#x27;ll initially create an unencrypted connection between queues on two different MQ hosts. These are not replicated or in any sort of failover but are designed to illustrate messages being forwarded from one queue to another.</p><p>Create a queue manager and start it up</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ~]$ crtmqm QM1 &amp;&amp; strmqm QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM1&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directory &#x27;/var/mqm/qmgrs/QM1&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The queue manager is associated with installation &#x27;Installation1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating or replacing default objects for queue manager &#x27;QM1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default objects statistics : 83 created. 0 replaced. 0 failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Completing setup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setup completed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The system resource RLIMIT_NOFILE is set at an unusually low level for IBM MQ.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM1&#x27; starting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The queue manager is associated with installation &#x27;Installation1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 log records accessed on queue manager &#x27;QM1&#x27; during the log replay phase.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Log replay for queue manager &#x27;QM1&#x27; complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction manager state recovered for queue manager &#x27;QM1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plain text communication is enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM1&#x27; started using V9.2.5.0.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a transmission queue on QM1</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ~]$ runmqsc QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">define qlocal(QM2) DESCR(&#x27;Transmission queue to QM2&#x27;) USAGE(XMITQ)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : define qlocal(QM2) DESCR(&#x27;Transmission queue to QM2&#x27;) USAGE(XMITQ)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8006I: IBM MQ queue created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a remote receiver queue on QM1 to represent the remote queue that will live on QM2 on the remote host</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">define qremote(QUEUE.ON.QM2) DESCR(&#x27;Remote queue for QM2&#x27;) XMITQ(QM2) RNAME(RECEIVEQUEUE) RQMNAME(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : define qremote(QUEUE.ON.QM2) DESCR(&#x27;Remote queue for QM2&#x27;) XMITQ(QM2) RNAME(RECEIVEQUEUE) RQMNAME(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8006I: IBM MQ queue created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create the sender channel on QM1</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">define channel(QM1.TO.QM2) CHLTYPE(SDR) CONNAME(&#x27;10.241.0.4&#x27;) TRPTYPE(TCP) XMITQ(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : define channel(QM1.TO.QM2) CHLTYPE(SDR) CONNAME(&#x27;10.241.0.4&#x27;) TRPTYPE(TCP) XMITQ(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8014I: IBM MQ channel created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Start up the sender channel on QM1</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">START CHANNEL(QM1.TO.QM2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On our remote host, (wdc1-mq1), create a single queue</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ crtmqm QM2 &amp;&amp; strmqm QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM2&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directory &#x27;/var/mqm/qmgrs/QM2&#x27; created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The queue manager is associated with installation &#x27;Installation1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating or replacing default objects for queue manager &#x27;QM2&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default objects statistics : 83 created. 0 replaced. 0 failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Completing setup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setup completed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM2&#x27; starting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The queue manager is associated with installation &#x27;Installation1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 log records accessed on queue manager &#x27;QM2&#x27; during the log replay phase.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Log replay for queue manager &#x27;QM2&#x27; complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction manager state recovered for queue manager &#x27;QM2&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plain text communication is enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM MQ queue manager &#x27;QM2&#x27; started using V9.2.5.0.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create the receiver queue on the remote host (wdc1-mq1)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE QLOCAL(RECEIVEQUEUE) DESCR(&#x27;Receiving queue&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a listener on the remote host (wdc1-mq1) called LISTENER1. In the MQSC interface, type:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE LISTENER(LISTENER1) TRPTYPE(TCP) PORT(1414) CONTROL(QMGR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">START LISTENER(LISTENER1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Port 1414 is the default. If we want to use anything different, we&#x27;ll need to update the sender channel on QM1.</p><p>Create a receiver channel on the remote host (wdc1-mq1) called QM1.TO.QM2. The channel must have the same name as the sender channel on the source queue manager.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ~]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFINE CHANNEL(QM1.TO.QM2) CHLTYPE(RCVR) TRPTYPE(TCP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4 : DEFINE CHANNEL(QM1.TO.QM2) CHLTYPE(RCVR) TRPTYPE(TCP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8014I: IBM MQ channel created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now start up the channel on the remote</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">START CHANNEL(QM1.TO.QM2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Back on the local mq host (wdc-mq-client), let&#x27;s test the connection with the included sample programs. Hit enter twice to exit</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ~]$ /opt/mqm/samp/bin/amqsput QUEUE.ON.QM2 QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSPUT0 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target queue is QUEUE.ON.QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this is a test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">another message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the remote host, run</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ amqsget RECEIVEQUEUE QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSGET0 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;this is a test&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;testing&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;another message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">no more messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSGET0 end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ve now verified that the queues are able to send and receive.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-two-queue-managers-via-ssltls-and-self-signed-certs">Connecting two queue managers via SSL/TLS and self-signed certs<a href="#connecting-two-queue-managers-via-ssltls-and-self-signed-certs" class="hash-link" aria-label="Direct link to Connecting two queue managers via SSL/TLS and self-signed certs" title="Direct link to Connecting two queue managers via SSL/TLS and self-signed certs">​</a></h3><p>Create a keystore on the local host (wdc-mq-client)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqakm -keydb -create -db /var/mqm/qmgrs/QM1/ssl/key.kdb -type cms -pw &#x27;p@ssw0rd&#x27; -stash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a keystore on the remote host (wdc1-mq1)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqakm -keydb -create -db /var/mqm/qmgrs/QM2/ssl/key.kdb -type cms -pw &#x27;p@ssw0rd&#x27; -stash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a self-signed cert on the local host (wdc-mq-client). For production envs, this should be an actual signed cert.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqakm -cert -create -db /var/mqm/qmgrs/QM1/ssl/key.kdb -stashed -label QM1 -dn &quot;cn=QM1,O=IBM,C=US,OU=SSL For MQ,ST=MA&quot; -size 2048 -x509version 3 -expire 7300 -sig_alg SHA256WithRSA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a self-signed cert on the remote host (wdc1-mq1). For production envs, this should be an actual signed cert.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqakm -cert -create -db /var/mqm/qmgrs/QM2/ssl/key.kdb -stashed -label QM2 -dn &quot;cn=QM2,O=IBM,C=US,OU=SSL For MQ,ST=MA&quot; -size 2048 -x509version 3 -expire 7300 -sig_alg SHA256WithRSA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extract the public cert from the local host (wdc-mq-client)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqakm -cert -extract -db /var/mqm/qmgrs/QM1/ssl/key.kdb -stashed -label QM1 -target QM1_public.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extract the public cert from the remote host (wdc1-mq1)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqakm -cert -extract -db /var/mqm/qmgrs/QM2/ssl/key.kdb -stashed -label QM2 -target QM2_public.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Copy the QM1_public.txt to the remote MQ (wdc1-mq1) host and import it into the keystore</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqakm -cert -add -db /var/mqm/qmgrs/QM2/ssl/key.kdb -stashed -label QM1 -file QM1_public.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Copy the QM2_public.txt to the local host (wdc-mq-client) and import it into the keystore</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqakm -cert -add -db /var/mqm/qmgrs/QM1/ssl/key.kdb -stashed -label QM2 -file QM2_public.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the local host (wdc-mq-client) update the sender channel to use SSL, then refresh and make sure the channel is started</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqsc QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(QM1.TO.QM2) CHLTYPE(SDR) TRPTYPE(TCP) SSLCIPH(&#x27;TLS_RSA_WITH_AES_128_CBC_SHA256&#x27;) DESCR(&#x27;Sender channel using TLS from QM1 to QM2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     5 : alter channel(QM1.TO.QM2) CHLTYPE(SDR) TRPTYPE(TCP) SSLCIPH(&#x27;TLS_RSA_WITH_AES_128_CBC_SHA256&#x27;) DESCR(&#x27;Sender channel using TLS from QM1 to QM2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8016I: IBM MQ channel changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start channel(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the remote host (wdc1-mq1) update the reciever channel to use SSL</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(QM1.TO.QM2) CHLTYPE(RCVR) TRPTYPE(TCP) SSLCIPH(&#x27;TLS_RSA_WITH_AES_128_CBC_SHA256&#x27;) SSLCAUTH(REQUIRED) DESCR(&#x27;Receiver channel using TLS from QM1 to QM2&#x27;) CERTLABL(&#x27;QM2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2 : alter channel(QM1.TO.QM2) CHLTYPE(RCVR) TRPTYPE(TCP) SSLCIPH(&#x27;TLS_RSA_WITH_AES_128_CBC_SHA256&#x27;) SSLCAUTH(REQUIRED) DESCR(&#x27;Receiver channel using TLS from QM1 to QM2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8016I: IBM MQ channel changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start channel(QM1.TO.QM2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alter the QMGR on the remote host (wdc1-mq1) to point to the correct cert label we created</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter qmgr certlabl(&#x27;QM2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(all)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alter the QMGR on the local host (wdc1-mq1) to point to the correct cert label we created</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqsc QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter qmgr certlabl(&#x27;QM1&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(all)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Back on the local, let&#x27;s test the connection with the included sample programs. Hit enter twice to exit</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ~]$ /opt/mqm/samp/bin/amqsput QUEUE.ON.QM2 QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSPUT0 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target queue is QUEUE.ON.QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this is a test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">another message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the remote host, run</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 ssl]$ amqsget RECEIVEQUEUE QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSGET0 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;Sample AMQSPUT0 start&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;target queue is QUEUE.ON.QM2&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;this is a test&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;testing&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message &lt;another message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">no more messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSGET0 end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ve now verified that messages are being forwarded between queues via a TLS connection. Let&#x27;s check our peering on local queue</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client ssl]$ runmqsc QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10 : DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8417I: Display Channel Status details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CHANNEL(QM1.TO.QM2)                     CHLTYPE(SDR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CONNAME(10.241.0.4(1414))               CURRENT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RQMNAME(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCERTI(CN=QM2,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLPEER(SERIALNUMBER=5E:C8:76:52:DA:81:96:5B,CN=QM2,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STATUS(RUNNING)                         SUBSTATE(MQGET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   XMITQ(QM2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check our peering on the remote queue</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 errors]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8417I: Display Channel Status details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CHANNEL(QM1.TO.QM2)                     CHLTYPE(RCVR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CONNAME(10.241.2.5)                     CURRENT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RQMNAME(QM1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCERTI(CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLPEER(SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STATUS(RUNNING)                         SUBSTATE(RECEIVE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="denying-connections-based-on-sslpeer">Denying connections based on SSLPEER<a href="#denying-connections-based-on-sslpeer" class="hash-link" aria-label="Direct link to Denying connections based on SSLPEER" title="Direct link to Denying connections based on SSLPEER">​</a></h3><p>For this we are going to the remote queue and setting an SSL Peer setting for QM2</p><p>On the remote host, start up the runmqsc session and set the SSLPEER value</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 errors]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(QM1.TO.QM2) CHLTYPE(RCVR) SSLPEER(&#x27;CN=John Cena, OU=Test, O=IBM, C=GB&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now attempt to connect and run the test from the local mq host</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc-mq-client errors]$ /opt/mqm/samp/bin/amqsput QUEUE.ON.QM2 QM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSPUT0 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target queue is QUEUE.ON.QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample AMQSPUT0 end`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These messages will not show up on our remote host. Instead we can see the following error in the AMQ001.log</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">06/28/2022 06:23:34 PM - Process(2051233.5) User(mqm) Program(amqrmppa)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Host(wdc1-mq1) Installation(Installation1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    VRMF(9.2.5.0) QMgr(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Time(2022-06-28T18:23:34.836Z)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    RemoteHost(10.241.2.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CommentInsert1(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CommentInsert2(SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CommentInsert3(10.241.2.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ9636E: SSL distinguished name does not match peer name, channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;QM1.TO.QM2&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPLANATION:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The distinguished name, &#x27;SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQ,O=IBM,ST=MA,C=US&#x27;, contained in the SSL certificate for the remote end of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the channel does not match the local SSL peer name for channel &#x27;QM1.TO.QM2&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The distinguished name at the remote host &#x27;10.241.2.5&#x27; must match the peer name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">specified (which can be generic) before the channel can be started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ACTION:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If this remote system should be allowed to connect, either change the SSL peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name specification for the local channel so that it matches the distinguished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name in the SSL certificate for the remote end of the channel, or obtain the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">correct certificate for the remote end of the channel.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This error might indicate that the remote end of the channel is configured to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use the wrong certificate. Check the certificate label for the remote end of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the channel.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart the channel.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we remove the SSLPEER setting for that channel on the remote, we can see that connectivity should resume.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">display channel(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : display channel(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8414I: Display Channel details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CHANNEL(QM1.TO.QM2)                     CHLTYPE(RCVR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ALTDATE(2022-06-28)                     ALTTIME(18.21.00)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   BATCHSZ(50)                             CERTLABL(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   COMPHDR(NONE)                           COMPMSG(NONE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   DESCR(Receiver channel using TLS from QM1 to QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   HBINT(300)                              KAINT(AUTO)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MAXMSGL(4194304)                        MCAUSER( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MONCHL(QMGR)                            MRDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MREXIT( )                               MRRTY(10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MRTMR(1000)                             MSGDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MSGEXIT( )                              NPMSPEED(FAST)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PUTAUT(DEF)                             RCVDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RCVEXIT( )                              RESETSEQ(NO)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SCYDATA( )                              SCYEXIT( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SENDDATA( )                             SENDEXIT( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SEQWRAP(999999999)                      SSLCAUTH(REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCIPH(TLS_RSA_WITH_AES_128_CBC_SHA256)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLPEER(CN=John Cena, OU=Test, O=IBM, C=GB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STATCHL(QMGR)                           TRPTYPE(TCP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   USEDLQ(YES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(QM1.TO.QM2) CHLTYPE(RCVR) SSLPEER(&#x27;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2 : alter channel(QM1.TO.QM2) CHLTYPE(RCVR) SSLPEER(&#x27;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8016I: IBM MQ channel changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">display channel(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3 : display channel(QM1.TO.QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8414I: Display Channel details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CHANNEL(QM1.TO.QM2)                     CHLTYPE(RCVR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ALTDATE(2022-06-28)                     ALTTIME(18.31.34)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   BATCHSZ(50)                             CERTLABL(QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   COMPHDR(NONE)                           COMPMSG(NONE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   DESCR(Receiver channel using TLS from QM1 to QM2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   HBINT(300)                              KAINT(AUTO)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MAXMSGL(4194304)                        MCAUSER( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MONCHL(QMGR)                            MRDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MREXIT( )                               MRRTY(10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MRTMR(1000)                             MSGDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MSGEXIT( )                              NPMSPEED(FAST)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PUTAUT(DEF)                             RCVDATA( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RCVEXIT( )                              RESETSEQ(NO)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SCYDATA( )                              SCYEXIT( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SENDDATA( )                             SENDEXIT( )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SEQWRAP(999999999)                      SSLCAUTH(REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCIPH(TLS_RSA_WITH_AES_128_CBC_SHA256)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLPEER( )                              STATCHL(QMGR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   TRPTYPE(TCP)                            USEDLQ(YES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4 : refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8724I: Refresh IBM MQ Queue Manager accepted.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So what can we do with SSLPEER?</p><p>We can lock the receiver channel to one certificate by simply storing the CN info of our client cert into the SSLPEER field.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 errors]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : DISPLAY CHS(QM1.TO.QM2) SSLPEER SSLCERTI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8417I: Display Channel Status details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CHANNEL(QM1.TO.QM2)                     CHLTYPE(RCVR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CONNAME(10.241.2.5)                     CURRENT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RQMNAME(QM1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCERTI(CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLPEER(SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   STATUS(RUNNING)                         SUBSTATE(RECEIVE)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The SSLPEER setting above is what was read from the client self-signed cert. We can take that value and apply it to the channel itself and then any future certs will be rejected. So not everybody can connect even if their public cert is in the remote host keystore.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mqm@wdc1-mq1 errors]$ runmqsc QM2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5724-H72 (C) Copyright IBM Corp. 1994, 2022.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting MQSC for queue manager QM2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alter channel(QM1.TO.QM2) CHLTYPE(RCVR) SSLPEER(&#x27;SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : alter channel(QM1.TO.QM2) CHLTYPE(RCVR) SSLPEER(&#x27;SERIALNUMBER=78:40:26:54:E5:D4:80:E4,CN=QM1,OU=SSL For MQ,O=IBM,ST=MA,C=US&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8016I: IBM MQ channel changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2 : refresh qmgr type(configev) object(channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMQ8724I: Refresh IBM MQ Queue Manager accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Reference Links:</p><p><a href="https://www.ibm.com/docs/en/ibm-mq/9.2?topic=windows-setting-up-key-repository-aix-linux" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/ibm-mq/9.2?topic=windows-setting-up-key-repository-aix-linux</a></p><p><a href="https://www.ibm.com/docs/en/ibm-mq/9.0?topic=tls-configuring-security-mq" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/ibm-mq/9.0?topic=tls-configuring-security-mq</a></p><p><a href="https://www.ibm.com/docs/en/ibm-mq/9.0?topic=securing-planning-your-security-requirements" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/ibm-mq/9.0?topic=securing-planning-your-security-requirements</a></p><p><a href="https://www.ibm.com/docs/en/ibm-mq/9.0?topic=mechanisms-message-security-in-mq" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/ibm-mq/9.0?topic=mechanisms-message-security-in-mq</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ibm-client-engineering/solution-mq-rdqm-hadr.git/docs/2-Prepare/1-Learn.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/solution-mq-rdqm-hadr/category/prepare"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prepare</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/solution-mq-rdqm-hadr/Prepare/organize"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Organize</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installing-and-configuring-ibm-mq-and-rdqm" class="table-of-contents__link toc-highlight">Installing and Configuring IBM MQ and RDQM</a></li><li><a href="#installation-of-mq" class="table-of-contents__link toc-highlight">Installation of MQ</a><ul><li><a href="#host-layout" class="table-of-contents__link toc-highlight">Host layout</a></li><li><a href="#system-preparation" class="table-of-contents__link toc-highlight">System preparation</a></li><li><a href="#installing-mq" class="table-of-contents__link toc-highlight">Installing MQ</a></li></ul></li><li><a href="#installing-rdqm" class="table-of-contents__link toc-highlight">Installing RDQM</a></li><li><a href="#creating-a-disaster-recovery-queue" class="table-of-contents__link toc-highlight">Creating A Disaster Recovery Queue</a><ul><li><a href="#creating-drhaqm1-with-primary-in-dc" class="table-of-contents__link toc-highlight">Creating DRHAQM1 With Primary in DC</a></li></ul></li><li><a href="#installing-mqipt" class="table-of-contents__link toc-highlight">Installing MQIPT</a><ul><li><a href="#enable-mqipt-as-a-system-service" class="table-of-contents__link toc-highlight">Enable MQIPT as a system service</a></li><li><a href="#templating-the-service-file-for-multiple-mqipt-instances" class="table-of-contents__link toc-highlight">Templating the service file for multiple MQIPT instances</a></li><li><a href="#creating-the-new-queue-manager" class="table-of-contents__link toc-highlight">Creating the new queue manager</a></li><li><a href="#configuring-ssl-in-queue-manager-and-client" class="table-of-contents__link toc-highlight">Configuring SSL in Queue Manager and client</a></li><li><a href="#setting-the-channel-auth-for-ssl" class="table-of-contents__link toc-highlight">Setting the channel auth for SSL</a></li></ul></li><li><a href="#configuring-mq-ipt-for-sslserverclient" class="table-of-contents__link toc-highlight">Configuring MQ-IPT for SSLServer/Client</a></li><li><a href="#mq-to-mq-and-ssl-encryption" class="table-of-contents__link toc-highlight">MQ to MQ and SSL encryption</a></li><li><a href="#connecting-two-queue-managers-via-ssltls-and-self-signed-certs" class="table-of-contents__link toc-highlight">Connecting two queue managers via SSL/TLS and self-signed certs</a></li><li><a href="#denying-connections-based-on-sslpeer" class="table-of-contents__link toc-highlight">Denying connections based on SSLPEER</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ibm.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM</a></li><li class="footer__item"><a href="https://www.ibm.com/client-engineering" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM Client Engineering</a></li></ul></div></div></div></footer></div>
<script src="/solution-mq-rdqm-hadr/assets/js/runtime~main.ae90d6c1.js"></script>
<script src="/solution-mq-rdqm-hadr/assets/js/main.2f67b9e3.js"></script>
</body>
</html>